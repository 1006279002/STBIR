seed: 114

data:
  val_ratio: 0.1
  image_size: 256
  negatives_per_modality:
    sketch: 6
    image: 6
    text: 6
  curriculum_noise:
    enable: true
    start_epoch: 0
    ramp_epochs: 8
    initial_prob: 0.05
    max_prob: 0.6
    initial_strength: 0.2
    max_strength: 1.0
    per_stage:
      sketch:
        start_epoch: 0
        ramp_epochs: 4
        max_prob: 0.7
        max_strength: 1.0
      image:
        start_epoch: 2
        ramp_epochs: 6
      text:
        enable: false
    augment:
      image:
        gaussian_sigma: [0.0, 0.12]
        blur_radius: [0.0, 1.3]
        jpeg_quality: [45, 85]
        cutout_ratio: [0.05, 0.12]
      sketch:
        gaussian_sigma: [0.0, 0.18]
        blur_radius: [0.0, 0.6]
        contrast: [0.85, 1.2]
        cutout_ratio: [0.02, 0.05]
  manifests:
    train: manifests/train_manifest.jsonl
    val: manifests/val_manifest.jsonl
    test: manifests/test_manifest.jsonl
  datasets:
    chair:
      train:
        text: datasets/chair_train.txt
        image_dir: datasets/datasets/ChairV2/trainB
        sketch_dir: datasets/datasets/ChairV2/trainA
        noise_dir: datasets/datasets/ChairV2/train_noise
      test:
        text: datasets/chair_test.txt
        image_dir: datasets/datasets/ChairV2/testB
        sketch_dir: datasets/datasets/ChairV2/testA
        noise_dir: datasets/datasets/ChairV2/test_noise
    shoe:
      train:
        text: datasets/shoe_train.txt
        image_dir: datasets/datasets/ShoeV2/trainB
        sketch_dir: datasets/datasets/ShoeV2/trainA
        noise_dir: datasets/datasets/ShoeV2/train_noise
      test:
        text: datasets/shoe_test.txt
        image_dir: datasets/datasets/ShoeV2/testB
        sketch_dir: datasets/datasets/ShoeV2/testA
        noise_dir: datasets/datasets/ShoeV2/test_noise

model:
  clip_model: ViT-B/32
  sketch_backbone: resnet50
  sketch_pretrained: true
  feature_dim: 512
  fusion_strategy: mean
  classification:
    mode: arcface
    margin: 0.2
    scale: 32.0

training:
  batch_size: 16
  num_workers: 4
  device: cuda
  loader:
    persistent_workers: true
    prefetch_factor: 4
    pin_memory: true
    cudnn_benchmark: true
  gradient_clip: 1.0
  checkpoint:
    dir: checkpoints
    keep_last: 3
    monitor: val/loss
  stages:
    - name: sketch_alignment
      target: sketch
      epochs: 8
      lr: 5.0e-5
      weight_decay: 1.0e-4
    - name: image_alignment
      target: image
      epochs: 12
      lr: 5.0e-5
      weight_decay: 1.0e-4
    - name: text_alignment
      target: text
      epochs: 8
      lr: 5.0e-5
      weight_decay: 1.0e-4

loss:
  temperature: 0.07
  triplet_margin: 0.2
  weights:
    info_nce: 0.8
    triplet: 0.7
    cls: 0.2

retrieval:
  top_k: 10
  results_dir: outputs/retrieval
